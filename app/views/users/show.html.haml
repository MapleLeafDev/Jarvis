:javascript
  function showTodays(){
    event.preventDefault();
    $('#stats').hide();
    $('#todays').show();
    $('#needed').hide();
    $('#all').hide();
    $('#stats-tab').removeClass('active');
    $('#todays-tab').addClass('active');
    $('#needed-tab').removeClass('active');
    $('#all-tab').removeClass('active');
    $('#s-tab').removeClass('active');
    $('#t-tab').addClass('active');
    $('#n-tab').removeClass('active');
    $('#a-tab').removeClass('active');

  }

  function showNeeded(){
    event.preventDefault();
    $('#stats').hide();
    $('#todays').hide();
    $('#needed').show();
    $('#all').hide();
    $('#stats-tab').removeClass('active');
    $('#todays-tab').removeClass('active');
    $('#needed-tab').addClass('active');
    $('#all-tab').removeClass('active');
    $('#s-tab').removeClass('active');
    $('#t-tab').removeClass('active');
    $('#n-tab').addClass('active');
    $('#a-tab').removeClass('active');
  }

  function showAll(){
    event.preventDefault()
    $('#stats').hide();
    $('#todays').hide();
    $('#needed').hide();
    $('#all').show();
    $('#stats-tab').removeClass('active');
    $('#todays-tab').removeClass('active');
    $('#needed-tab').removeClass('active');
    $('#all-tab').addClass('active');
    $('#s-tab').removeClass('active');
    $('#t-tab').removeClass('active');
    $('#n-tab').removeClass('active');
    $('#a-tab').addClass('active');
  }

.span8
  %div{align: "center"}
    = image_tag(gravatar_for(@user.email == nil || @user.email == "" ? @user.name : @user.email))
    .lead= @user.name
  .row
    %p
    %ul.nav.nav-tabs.visible-desktop.visible-tablet
      %li.active{id: "stats-tab"}
        = link_to 'Status', user_path
      %li{id: "todays-tab"}
        = link_to 'Todays', '#', onclick: "showTodays();"
      %li{id: "needed-tab"}
        = link_to 'As Needed', '#', onclick: "showNeeded();"
      %li{id: "all-tab"}
        = link_to 'All', '#', onclick: "showAll();"
    %ul.nav.nav-tabs.visible-phone
      %li.active{id: "s-tab"}
        = link_to 'Status', user_path
      %li{id: "t-tab"}
        = link_to 'Todays', '#', onclick: "showTodays();"
      %li{id: "n-tab"}
        = link_to 'Needed', '#', onclick: "showNeeded();"
      %li{id: "a-tab"}
        = link_to 'All', '#', onclick: "showAll();"
  %div{id: "stats"}
    %h4 Progress for Today
    %div
      - today_complete = Completion.where(completed: Time.zone.today.to_s, user_id: @user.id, task_id: @todays.collect(&:id)).count
      - percent_done = today_complete.to_f/@todays.count.to_f*100
      = today_complete
      = "/"
      = @todays.count
      %p
        .progress{class: "progress progress-striped progress-#{if percent_done <= 33 then 'danger' elsif percent_done > 33 && percent_done <= 66 then 'warning' else 'success' end}"}
          .bar{:style => "width: #{percent_done}%;"}
    - if @overdue.count > 0
      %h4 Overdue
      %table.table
        %col{:width => "10%"}
        %col{:width => "10%"}
        %col{:width => "80%"}
        %tr
          %th Days
          %th
          %th Chore
        - @overdue.sort.each do |task|
          %tr
            %td= if task.completions.count > 0 then (Date.today - Date.parse(task.completions.last.completed)).to_i else (Date.today - Date.parse(task.created_at)).to_i  end
            %td
              %a{class: "badge badge-inverse"}
                = if task.monthly then 'Monthly' else 'Weekly' end
            %td= link_to task.title, task
  %div{id: "todays", hidden: true}
    %h4 Todays Chores
    - @todays.group_by(&:period).sort.each do |key, tasks|
      - period = tasks.first.period
      = if period == 1 then 'Morning' elsif period == 2 then 'Noon' elsif period == 3 then 'Evening' else 'Anytime' end
      %table.table
        -tasks.each do |task|
          %tr
            %td
              .span5
                = link_to task.title, task
              .span1{ id: "task-#{task.id}" }
                -if Completion.find_by_user_id_and_task_id_and_completed(@user.id, task.id, @time)
                  = link_to '', '#', class: "i icon-ok btn btn-success"
                -else
                  = link_to '', complete_task_path(task: task.id, user: @user.id), class: "i icon-ok btn", remote: true
  %div{id: "needed", hidden: true}
    %h4 As Needed Chores
    %table.table
      %col{:width => "10%"}
      %col{:width => "10%"}
      %col{:width => "80%"}
      %tr
        %th Days
        %th
        %th Chore
      - @as_needed.sort.each do |task|
        %tr
          %td
            = if task[1].completions.count > 0 then (Date.today - Date.parse(task[0]) ).to_i else 'Not Done' end
          %td
            %a{class: "badge badge-inverse"}
              = if task[1].monthly then 'Monthly' else 'Weekly' end
          %td
            .span4
              = link_to task[1].title, task[1]
            .span1{ id: "task-#{task[1].id}" }
              = link_to '', complete_task_path(task: task[1].id, user: @user.id), class: "i icon-ok btn", remote: true
  %div{id: "all", hidden: true}
    %h4 All Chores
    - @all.sort_by{ |t| t.period }.each do |task|
      = render partial: 'chore', locals: { task: task }
.span2{align: "center"}
  %p
  -if current_user.user_type >= 20
    = link_to " Chore", new_task_path, class: "i icon-plus btn"
    %p
  .lead Credits
  %div.well.well-small#credits
    -if current_user.user_type < 10
      .lead
        =current_user.credits
    -else
      %table{width: "100%"}
        -children.each do |member|
          %tr
            %td=member.name
            %td=member.credits